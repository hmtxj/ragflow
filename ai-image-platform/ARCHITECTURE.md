# AI Image Platform - ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ—ï¸ æ•´ä½“æ¶æ„

AI Image Platform é‡‡ç”¨ç°ä»£åŒ–çš„å¾®æœåŠ¡æ¶æ„ï¼Œå…·å¤‡é«˜å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œä¼ä¸šçº§å®‰å…¨ç‰¹æ€§ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Load Balancer â”‚    â”‚     CDN         â”‚    â”‚   Monitoring    â”‚
â”‚    (Nginx)      â”‚    â”‚   (CloudFlare)  â”‚    â”‚ (Prometheus)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   React SPA     â”‚  â”‚   Admin Panel   â”‚  â”‚   Mobile App    â”‚ â”‚
â”‚  â”‚  (TypeScript)   â”‚  â”‚  (TypeScript)   â”‚  â”‚  (React Native) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API Gateway                             â”‚
â”‚                        (FastAPI)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Business Logic Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  User Service   â”‚  â”‚  Image Service  â”‚  â”‚  AI Service     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Auth Service   â”‚  â”‚ Payment Service â”‚  â”‚ Notification    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Data Layer                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   PostgreSQL    â”‚  â”‚      Redis      â”‚  â”‚   File Storage  â”‚ â”‚
â”‚  â”‚   (Primary DB)  â”‚  â”‚    (Cache)      â”‚  â”‚     (S3/Local)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    External Services                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    OpenAI       â”‚  â”‚  Stability AI   â”‚  â”‚   Midjourney    â”‚ â”‚
â”‚  â”‚   (DALL-E)      â”‚  â”‚ (Stable Diff.)  â”‚  â”‚    (API)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€æœ¯æ ˆè¯¦è§£

### å‰ç«¯æŠ€æœ¯æ ˆ
- **React 18**: ç°ä»£åŒ–å‰ç«¯æ¡†æ¶ï¼Œæ”¯æŒå¹¶å‘ç‰¹æ€§
- **TypeScript**: ç±»å‹å®‰å…¨ï¼Œæé«˜ä»£ç è´¨é‡
- **Vite**: å¿«é€Ÿæ„å»ºå·¥å…·ï¼Œçƒ­æ›´æ–°
- **TailwindCSS**: å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶
- **Zustand**: è½»é‡çº§çŠ¶æ€ç®¡ç†
- **React Query**: æœåŠ¡å™¨çŠ¶æ€ç®¡ç†å’Œç¼“å­˜
- **React Hook Form**: é«˜æ€§èƒ½è¡¨å•å¤„ç†
- **Framer Motion**: æµç•…åŠ¨ç”»æ•ˆæœ

### åç«¯æŠ€æœ¯æ ˆ
- **FastAPI**: é«˜æ€§èƒ½å¼‚æ­¥Webæ¡†æ¶
- **SQLAlchemy**: ORMæ¡†æ¶ï¼Œæ”¯æŒå¼‚æ­¥æ“ä½œ
- **Alembic**: æ•°æ®åº“è¿ç§»å·¥å…·
- **Pydantic**: æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
- **Celery**: åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—
- **JWT**: æ— çŠ¶æ€èº«ä»½è®¤è¯
- **Structlog**: ç»“æ„åŒ–æ—¥å¿—è®°å½•

### æ•°æ®å­˜å‚¨
- **PostgreSQL 15**: ä¸»æ•°æ®åº“ï¼Œæ”¯æŒJSONå’Œå…¨æ–‡æœç´¢
- **Redis 7**: ç¼“å­˜ã€ä¼šè¯å­˜å‚¨ã€ä»»åŠ¡é˜Ÿåˆ—
- **AWS S3**: æ–‡ä»¶å­˜å‚¨ï¼ˆå¯é€‰æœ¬åœ°å­˜å‚¨ï¼‰

### åŸºç¡€è®¾æ–½
- **Docker**: å®¹å™¨åŒ–éƒ¨ç½²
- **Nginx**: åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡
- **Prometheus**: ç›‘æ§æŒ‡æ ‡æ”¶é›†
- **Grafana**: ç›‘æ§æ•°æ®å¯è§†åŒ–
- **Sentry**: é”™è¯¯è¿½è¸ªå’Œæ€§èƒ½ç›‘æ§

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### æ ¸å¿ƒå®ä½“å…³ç³»å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚â”€â”€â”€â”€â–¶â”‚   ApiConfig     â”‚     â”‚   StyleTag      â”‚
â”‚             â”‚     â”‚                 â”‚     â”‚                 â”‚
â”‚ - id        â”‚     â”‚ - id            â”‚     â”‚ - id            â”‚
â”‚ - email     â”‚     â”‚ - name          â”‚     â”‚ - name          â”‚
â”‚ - username  â”‚     â”‚ - type          â”‚     â”‚ - category      â”‚
â”‚ - plan      â”‚     â”‚ - provider      â”‚     â”‚ - type          â”‚
â”‚ - credits   â”‚     â”‚ - base_url      â”‚     â”‚ - popularity    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ - api_key       â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚            â”‚ - model         â”‚              â”‚
       â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
       â”‚                     â”‚                       â”‚
       â–¼                     â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚GeneratedImage   â”‚   â”‚GenerationHistoryâ”‚   â”‚   ImageLikes    â”‚
â”‚                 â”‚   â”‚                 â”‚   â”‚                 â”‚
â”‚ - id            â”‚   â”‚ - id            â”‚   â”‚ - user_id       â”‚
â”‚ - url           â”‚   â”‚ - status        â”‚   â”‚ - image_id      â”‚
â”‚ - prompt        â”‚   â”‚ - error_msg     â”‚   â”‚ - created_at    â”‚
â”‚ - style_tags    â”‚   â”‚ - credits_used  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - ratio         â”‚   â”‚ - created_at    â”‚
â”‚ - quality       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - is_public     â”‚
â”‚ - likes         â”‚
â”‚ - downloads     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®åº“ç´¢å¼•ç­–ç•¥
```sql
-- ç”¨æˆ·è¡¨ç´¢å¼•
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_plan ON users(plan);
CREATE INDEX idx_users_created_at ON users(created_at);

-- å›¾ç‰‡è¡¨ç´¢å¼•
CREATE INDEX idx_images_user_id ON generated_images(user_id);
CREATE INDEX idx_images_created_at ON generated_images(created_at);
CREATE INDEX idx_images_is_public ON generated_images(is_public);
CREATE INDEX idx_images_likes ON generated_images(likes);

-- é£æ ¼æ ‡ç­¾ç´¢å¼•
CREATE INDEX idx_style_tags_category ON style_tags(category);
CREATE INDEX idx_style_tags_popularity ON style_tags(popularity);
CREATE INDEX idx_style_tags_name_gin ON style_tags USING gin(name gin_trgm_ops);
```

## ğŸ” å®‰å…¨æ¶æ„

### è®¤è¯ä¸æˆæƒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client App    â”‚    â”‚   API Gateway   â”‚    â”‚  Auth Service   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚ 1. Login Request      â”‚                       â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ 2. Validate Creds    â”‚
         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
         â”‚                       â”‚ 3. JWT Token          â”‚
         â”‚ 4. JWT Token          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
         â”‚                       â”‚                       â”‚
         â”‚ 5. API Request + JWT  â”‚                       â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ 6. Verify JWT         â”‚
         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
         â”‚                       â”‚ 7. User Info          â”‚
         â”‚ 8. API Response       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
```

### æ•°æ®åŠ å¯†
- **ä¼ è¾“åŠ å¯†**: å…¨ç«™HTTPSï¼ŒTLS 1.3
- **å­˜å‚¨åŠ å¯†**: APIå¯†é’¥AES-256åŠ å¯†å­˜å‚¨
- **å¯†ç åŠ å¯†**: bcryptå“ˆå¸Œï¼Œç›å€¼éšæœºç”Ÿæˆ
- **JWTç­¾å**: HMAC-SHA256ç®—æ³•

### è®¿é—®æ§åˆ¶
```python
# åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
class Permission(Enum):
    READ_USER = "read:user"
    WRITE_USER = "write:user"
    READ_ADMIN = "read:admin"
    WRITE_ADMIN = "write:admin"
    GENERATE_IMAGE = "generate:image"
    MANAGE_API_CONFIG = "manage:api_config"

class Role(Enum):
    FREE_USER = [Permission.READ_USER, Permission.GENERATE_IMAGE]
    PRO_USER = [Permission.READ_USER, Permission.WRITE_USER, Permission.GENERATE_IMAGE, Permission.MANAGE_API_CONFIG]
    ENTERPRISE_USER = [Permission.READ_USER, Permission.WRITE_USER, Permission.GENERATE_IMAGE, Permission.MANAGE_API_CONFIG]
    ADMIN = [Permission.READ_ADMIN, Permission.WRITE_ADMIN, *Permission]
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser       â”‚    â”‚   CDN Cache     â”‚    â”‚  Redis Cache    â”‚
â”‚   Cache         â”‚    â”‚   (Static)      â”‚    â”‚  (Dynamic)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚ 1. Request            â”‚                       â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ 2. Cache Miss         â”‚
         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
         â”‚                       â”‚ 3. Cache Hit/Miss     â”‚
         â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ 4. Response + Cache   â”‚                       â”‚
         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
```

### æ•°æ®åº“ä¼˜åŒ–
- **è¿æ¥æ± **: SQLAlchemyè¿æ¥æ± ï¼Œæœ€å¤§20ä¸ªè¿æ¥
- **æŸ¥è¯¢ä¼˜åŒ–**: ç´¢å¼•ä¼˜åŒ–ï¼Œé¿å…N+1æŸ¥è¯¢
- **åˆ†é¡µæŸ¥è¯¢**: æ¸¸æ ‡åˆ†é¡µï¼Œæé«˜å¤§æ•°æ®é›†æ€§èƒ½
- **è¯»å†™åˆ†ç¦»**: ä¸»ä»å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»

### å¼‚æ­¥å¤„ç†
```python
# å›¾ç‰‡ç”Ÿæˆå¼‚æ­¥ä»»åŠ¡
@celery_app.task(bind=True, max_retries=3)
def generate_image_task(self, generation_request):
    try:
        # è°ƒç”¨AIæœåŠ¡ç”Ÿæˆå›¾ç‰‡
        image_url = ai_service.generate_image(generation_request)
        
        # ä¿å­˜åˆ°æ•°æ®åº“
        save_generated_image(image_url, generation_request)
        
        # å‘é€é€šçŸ¥
        notify_user(generation_request.user_id, "å›¾ç‰‡ç”Ÿæˆå®Œæˆ")
        
    except Exception as exc:
        # é‡è¯•æœºåˆ¶
        raise self.retry(exc=exc, countdown=60)
```

## ğŸ“Š ç›‘æ§ä¸å¯è§‚æµ‹æ€§

### ç›‘æ§æŒ‡æ ‡
```yaml
# Prometheusç›‘æ§æŒ‡æ ‡
metrics:
  - name: http_requests_total
    type: counter
    labels: [method, endpoint, status_code]
  
  - name: http_request_duration_seconds
    type: histogram
    labels: [method, endpoint]
  
  - name: active_users_total
    type: gauge
    
  - name: generation_requests_total
    type: counter
    labels: [model, quality, status]
  
  - name: credits_consumed_total
    type: counter
    labels: [user_plan]
  
  - name: database_connections_active
    type: gauge
  
  - name: redis_memory_usage_bytes
    type: gauge
```

### æ—¥å¿—ç»“æ„
```json
{
  "timestamp": "2024-01-01T00:00:00Z",
  "level": "INFO",
  "logger": "app.services.generation_service",
  "message": "Image generation started",
  "trace_id": "abc123",
  "span_id": "def456",
  "user_id": "user-uuid",
  "request_id": "req-uuid",
  "generation_params": {
    "model": "dall-e-3",
    "quality": "2K",
    "ratio": "1:1"
  }
}
```

### å‘Šè­¦è§„åˆ™
```yaml
# Prometheuså‘Šè­¦è§„åˆ™
groups:
  - name: api_alerts
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status_code=~"5.."}[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High error rate detected"
      
      - alert: DatabaseConnectionsHigh
        expr: database_connections_active > 15
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Database connections near limit"
```

## ğŸ”„ éƒ¨ç½²æ¶æ„

### å®¹å™¨åŒ–éƒ¨ç½²
```yaml
# Docker Composeç”Ÿäº§é…ç½®
version: '3.8'
services:
  nginx:
    image: nginx:alpine
    replicas: 2
    
  backend:
    image: ai-platform/backend:latest
    replicas: 3
    resources:
      limits:
        memory: 1G
        cpus: 0.5
    
  worker:
    image: ai-platform/backend:latest
    replicas: 2
    command: celery worker
    
  postgres:
    image: postgres:15
    volumes:
      - postgres_data:/var/lib/postgresql/data
    
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
```

### Kuberneteséƒ¨ç½²
```yaml
# Kuberneteséƒ¨ç½²é…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ai-platform-backend
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ai-platform-backend
  template:
    metadata:
      labels:
        app: ai-platform-backend
    spec:
      containers:
      - name: backend
        image: ai-platform/backend:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 5
```

## ğŸ”§ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•
- **æ— çŠ¶æ€è®¾è®¡**: APIæœåŠ¡æ— çŠ¶æ€ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
- **è´Ÿè½½å‡è¡¡**: Nginxè´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒå¤šå®ä¾‹
- **æ•°æ®åº“åˆ†ç‰‡**: æŒ‰ç”¨æˆ·IDåˆ†ç‰‡ï¼Œæ”¯æŒæ•°æ®åº“æ‰©å±•
- **ç¼“å­˜åˆ†å¸ƒ**: Redisé›†ç¾¤ï¼Œæ”¯æŒç¼“å­˜æ‰©å±•

### å‚ç›´æ‰©å±•
- **èµ„æºé…ç½®**: Dockerèµ„æºé™åˆ¶ï¼ŒK8sèµ„æºé…é¢
- **æ€§èƒ½è°ƒä¼˜**: æ•°æ®åº“è¿æ¥æ± ï¼Œå¼‚æ­¥å¤„ç†ä¼˜åŒ–
- **å­˜å‚¨ä¼˜åŒ–**: æ–‡ä»¶å‹ç¼©ï¼ŒCDNåŠ é€Ÿ

è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œå®‰å…¨æ€§ï¼Œèƒ½å¤Ÿæ”¯æŒä¼ä¸šçº§çš„ç”Ÿäº§ç¯å¢ƒéœ€æ±‚ã€‚